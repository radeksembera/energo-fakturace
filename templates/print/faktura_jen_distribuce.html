<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Faktura {{ faktura.cislo_faktury if faktura else 'XXXX' }}</title>
    <style>
        @page { 
            margin: 1cm;
            size: A4;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: "DejaVu Sans", Arial, sans-serif;
            font-size: 10px; 
            line-height: 1.2;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        /* Layout pomocÃ­ tabulek mÃ­sto Bootstrap gridu */
        .header-table {
            width: 100%;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .header-table td {
            vertical-align: top;
            padding: 5px;
        }
        
        .header-left {
            width: 50%;
        }
        
        .header-right {
            width: 50%;
            text-align: right;
        }
        
        .invoice-title {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            text-transform: uppercase;
            margin: 0 0 3px 0;
        }
        
        .invoice-subtitle {
            font-size: 12px;
            color: #6c757d;
            margin: 0 0 10px 0;
        }
        
        .company-info {
            margin-bottom: 8px;
        }
        
        .company-info h5 {
            font-size: 12px;
            margin: 0 0 3px 0;
            font-weight: bold;
        }
        
        .company-info p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        .invoice-details {
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 3px;
            border-left: 3px solid #007bff;
            margin-bottom: 8px;
        }
        
        .invoice-details h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        
        .invoice-details p {
            margin: 2px 0;
        }
        
        .address-block {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 8px;
            margin-top: 8px;
        }
        
        .address-block h6 {
            color: #007bff;
            margin: 0 0 5px 0;
            font-size: 11px;
            font-weight: bold;
        }
        
        .address-block p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        /* Tabulky */
        .section-title {
            color: #007bff;
            font-size: 12px;
            font-weight: bold;
            margin: 15px 0 5px 0;
        }
        
        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 9px;
        }
        
        .custom-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            padding: 4px 3px;
            border: 1px solid #007bff;
            text-align: left;
        }
        
        .custom-table td {
            padding: 3px;
            border: 1px solid #dee2e6;
            vertical-align: top;
        }
        
        .custom-table .text-end {
            text-align: right;
        }
        
        .custom-table .text-center {
            text-align: center;
        }
        
        /* CelkovÃ© ÄÃ¡stky */
        .final-total {
            background-color: #007bff !important;
            color: white !important;
            font-weight: bold !important;
        }
        
        .final-total td {
            background-color: #007bff !important;
            color: white !important;
            border-color: #007bff !important;
        }
        
        .total-section {
            background-color: #f8f9fa;
            border-radius: 3px;
            padding: 8px;
            text-align: center;
            margin: 10px 0;
        }
        
        .total-amount {
            background-color: #007bff;
            color: white;
            font-size: 14px;
            font-weight: bold;
            padding: 8px;
            border-radius: 3px;
            margin: 0;
        }
        
        /* Footer */
        .footer-section {
            margin-top: 15px;
            text-align: center;
            color: #6c757d;
            font-size: 9px;
        }
        
        .footer-section p {
            margin: 3px 0;
        }
        
        /* Utility classes */
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 2px; }
        .mb-2 { margin-bottom: 4px; }
        .mb-3 { margin-bottom: 6px; }
        .mt-3 { margin-top: 6px; }
        .mt-4 { margin-top: 8px; }
        .mt-5 { margin-top: 12px; }
        
        strong { font-weight: bold; }
        
        /* Page break control */
        .no-break {
            page-break-inside: avoid;
        }
        
        /* Format ÄÃ­sel s mezerami jako oddÄ›lovaÄi tisÃ­cÅ¯ */
        .number-format {
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- HLAVIÄŒKA -->
    <table class="header-table">
        <tr>
            <td class="header-left">
                <h1 class="invoice-title">FAKTURA</h1>
                <h2 class="invoice-subtitle">DAÅ‡OVÃ DOKLAD</h2>
                
                <div class="company-info">
                    <h5>{{ dodavatel.nazev_sro if dodavatel else 'Your energy, s.r.o.' }}</h5>
                    <p>{{ dodavatel.adresa_radek_1 if dodavatel else 'ItalskÃ¡ 2584/69' }}</p>
                    <p>{{ dodavatel.adresa_radek_2 if dodavatel else '120 00 Praha 2 - Vinohrady' }}</p>
                    <p><strong>DIÄŒ:</strong> {{ dodavatel.dic_sro if dodavatel else 'CZ24833851' }}</p>
                    <p><strong>IÄŒO:</strong> {{ dodavatel.ico_sro if dodavatel else '24833851' }}</p>
                </div>
                
                <div class="company-info">
                    <p><strong>Banka:</strong> {{ dodavatel.banka if dodavatel else 'BankovnÃ­ ÃºÄet Raiffeisenbank a.s. CZK' }}</p>
                    <p><strong>ÄŒ.ÃºÄ.:</strong> {{ dodavatel.cislo_uctu if dodavatel else '5041011366/5500' }}</p>
                    <p><strong>IBAN:</strong> {{ dodavatel.iban if dodavatel else 'CZ1055000000005041011366' }}</p>
                    <p><strong>SWIFT/BIC:</strong> {{ dodavatel.swift if dodavatel else 'RZBCCZPP' }}</p>
                </div>
            </td>
            
            <td class="header-right">
                <div class="invoice-details">
                    <h4>Faktura Ä. {{ faktura.cislo_faktury if faktura else '' }}</h4>
                    <p><strong>Konst. symbol:</strong> {{ faktura.konstantni_symbol if faktura else '' }}</p>
                    <p><strong>VS:</strong> {{ faktura.variabilni_symbol if faktura else '' }}</p>
                </div>
                
                <div class="address-block">
                    <h6>OdbÄ›ratel:</h6>
                    <p><strong>{{ odberatel.nazev_sro if odberatel else '' }}</strong></p>
                    <p>{{ odberatel.adresa_radek_1 if odberatel else '' }}</p>
                    <p>{{ odberatel.adresa_radek_2 if odberatel else '' }}</p>
                    <p><strong>IÄŒO:</strong> {{ odberatel.ico_sro if odberatel else '' }}</p>
                    <p><strong>DIÄŒ:</strong> {{ odberatel.dic_sro if odberatel else '' }}</p>
                </div>
                
                <div class="mt-3">
                    <p><strong>StÅ™edisko:</strong> {{ stredisko.stredisko }} {{ stredisko.nazev_strediska }}</p>
                    <p>{{ stredisko.stredisko_mail if stredisko.stredisko_mail else 'info@yourenergy.cz' }}</p>
                </div>
            </td>
        </tr>
    </table>

    <!-- DODACÃ A PLATEBNÃ PODMÃNKY -->
    <div class="no-break">
        <h5 class="section-title">DodacÃ­ a platebnÃ­ podmÃ­nky</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Datum splatnosti</th>
                    <th>Datum vystavenÃ­</th>
                    <th>Datum zdanit. plnÄ›nÃ­</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ faktura.datum_splatnosti.strftime('%d.%m.%Y') if faktura and faktura.datum_splatnosti else '' }}</td>
                    <td>{{ faktura.datum_vystaveni.strftime('%d.%m.%Y') if faktura and faktura.datum_vystaveni else '' }}</td>
                    <td>{{ faktura.datum_zdanitelneho_plneni.strftime('%d.%m.%Y') if faktura and faktura.datum_zdanitelneho_plneni else '' }}</td>
                </tr>
            </tbody>
        </table>
        
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Forma Ãºhrady</th>
                    <th>Popis dodÃ¡vky</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ faktura.forma_uhrady if faktura else '' }}</td>
                    <td>{{ faktura.popis_dodavky if faktura else 'VyÃºÄtovÃ¡nÃ­ ' + obdobi.rok|string + '%02d'|format(obdobi.mesic) }}</td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- REKAPITULACE -->
    <div class="no-break">
        <h5 class="section-title">Rekapitulace</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th><strong>Rekapitulace</strong></th>
                    <th>ZÃ¡klad danÄ›</th>
                    <th>Sazba DPH</th>
                    <th>ÄŒÃ¡stka DPH</th>
                    <th>Celkem vÄ. DPH</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>MÄ›sÃ­ÄnÃ­ plat (za jistiÄ)</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.platba_za_jistic).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.platba_za_jistic * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.platba_za_jistic * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr>
                    <td>Plat za elektÅ™inu ve VT</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.distribuce_vt).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.distribuce_vt * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.distribuce_vt * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr>
                    <td>Plat za elektÅ™inu ve NT</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.distribuce_nt).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.distribuce_nt * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.distribuce_nt * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr>
                    <td>Cena za systÃ©movÃ© sluÅ¾by</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.systemove_sluzby).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.systemove_sluzby * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.systemove_sluzby * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr>
                    <td>Podpora elekt. z podporovanÃ½ch zdrojÅ¯ energie</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.poze_minimum).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.poze_minimum * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.poze_minimum * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr>
                    <td>Poplatek za nesÃ­Å¥ovou infrastrukturu</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.nesitova_infrastruktura).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.nesitova_infrastruktura * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.nesitova_infrastruktura * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr>
                    <td>Dofakturace / Bonus</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.dofakturace_bonus).replace(',', ' ') }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.dofakturace_bonus * sazba_dph).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(rekapitulace.dofakturace_bonus * (1 + sazba_dph)).replace(',', ' ') }}</td>
                </tr>
                <tr class="final-total">
                    <td><strong>Celkem za doklad</strong></td>
                    <td class="text-end number-format"><strong>{{ "{:,.2f}".format(zaklad_bez_dph).replace(',', ' ') }}</strong></td>
                    <td class="text-end"></td>
                    <td class="text-end number-format"><strong>{{ "{:,.2f}".format(castka_dph).replace(',', ' ') }}</strong></td>
                    <td class="text-end number-format"><strong>{{ "{:,.2f}".format(celkem_vc_dph).replace(',', ' ') }}</strong></td>
                </tr>
                <tr>
                    <td>Zaplaceno zÃ¡lohou</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(-zaloha_hodnota).replace(',', ' ') if zaloha else "0,00" }}</td>
                    <td class="text-end">{{ sazba_dph_procenta }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(-zaloha_dph).replace(',', ' ') if zaloha else "0,00" }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(-zaloha_celkem_vc_dph).replace(',', ' ') if zaloha else "0,00" }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- K PLATBÄš -->
    <div class="total-section">
        <h4 class="total-amount">K platbÄ› celkem {{ "{:,.2f}".format(k_platbe).replace(',', ' ') }} KÄ</h4>
    </div>

    <!-- REKAPITULACE DPH -->
    <div class="no-break">
        <h5 class="section-title">Rekapitulace DPH</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Sazba DPH</th>
                    <th>ZÃ¡klad danÄ›</th>
                    <th>DPH</th>
                    <th>Celkem</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>ZÃ¡kladnÃ­ sazba 21 %</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(k_platbe / (1 + sazba_dph)).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(k_platbe * sazba_dph / (1 + sazba_dph)).replace(',', ' ') }}</td>
                    <td class="text-end number-format">{{ "{:,.2f}".format(k_platbe).replace(',', ' ') }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- FOOTER -->
    <div class="footer-section">
        <p>Rozpis jednotlivÃ½ch poloÅ¾ek faktury je uveden na nÃ¡sledujÃ­cÃ­ strÃ¡nÄ›.</p>
        <p><strong>FAKTURA:</strong> {{ faktura.cislo_faktury if faktura else '270325044' }}</p>
    </div>
</body>
</html>