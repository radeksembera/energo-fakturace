<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Faktura {{ faktura.cislo_faktury if faktura else 'XXXX' }}</title>
    <style>
        @page { 
            margin: 1.5cm;
            size: A4;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: "DejaVu Sans", Arial, sans-serif;
            font-size: 12px; 
            line-height: 1.4;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        /* Layout pomocí tabulek místo Bootstrap gridu */
        .header-table {
            width: 100%;
            margin-bottom: 20px;
            border-bottom: 3px solid #007bff;
            padding-bottom: 15px;
        }
        
        .header-table td {
            vertical-align: top;
            padding: 10px;
        }
        
        .header-left {
            width: 50%;
        }
        
        .header-right {
            width: 50%;
            text-align: right;
        }
        
        .invoice-title {
            font-size: 32px;
            font-weight: bold;
            color: #007bff;
            text-transform: uppercase;
            margin: 0 0 5px 0;
        }
        
        .invoice-subtitle {
            font-size: 16px;
            color: #6c757d;
            margin: 0 0 15px 0;
        }
        
        .company-info {
            margin-bottom: 15px;
        }
        
        .company-info h5 {
            font-size: 16px;
            margin: 0 0 5px 0;
            font-weight: bold;
        }
        
        .company-info p {
            margin: 2px 0;
            font-size: 12px;
        }
        
        .invoice-details {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
            margin-bottom: 15px;
        }
        
        .invoice-details h4 {
            margin: 0 0 10px 0;
            font-size: 18px;
        }
        
        .invoice-details p {
            margin: 3px 0;
        }
        
        .address-block {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .address-block h6 {
            color: #007bff;
            margin: 0 0 8px 0;
            font-size: 14px;
            font-weight: bold;
        }
        
        .address-block p {
            margin: 2px 0;
            font-size: 12px;
        }
        
        /* Tabulky */
        .section-title {
            color: #007bff;
            font-size: 16px;
            font-weight: bold;
            margin: 25px 0 10px 0;
        }
        
        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 11px;
        }
        
        .custom-table th {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            padding: 10px 8px;
            border: 1px solid #007bff;
            text-align: left;
        }
        
        .custom-table td {
            padding: 8px;
            border: 1px solid #dee2e6;
            vertical-align: top;
        }
        
        .custom-table .text-end {
            text-align: right;
        }
        
        .custom-table .text-center {
            text-align: center;
        }
        
        /* Celkové částky */
        .final-total {
            background-color: #007bff !important;
            color: white !important;
            font-weight: bold !important;
        }
        
        .final-total td {
            background-color: #007bff !important;
            color: white !important;
            border-color: #007bff !important;
        }
        
        .total-section {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            text-align: center;
            margin: 20px 0;
        }
        
        .total-amount {
            background-color: #007bff;
            color: white;
            font-size: 20px;
            font-weight: bold;
            padding: 15px;
            border-radius: 5px;
            margin: 0;
        }
        
        /* Footer */
        .footer-section {
            margin-top: 30px;
            text-align: center;
            color: #6c757d;
            font-size: 11px;
        }
        
        .footer-section p {
            margin: 5px 0;
        }
        
        /* Utility classes */
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mt-3 { margin-top: 12px; }
        .mt-4 { margin-top: 16px; }
        .mt-5 { margin-top: 24px; }
        
        strong { font-weight: bold; }
        
        /* Page break control */
        .no-break {
            page-break-inside: avoid;
        }
    </style>
</head>
<body>
    <!-- HLAVIČKA -->
    <table class="header-table">
        <tr>
            <td class="header-left">
                <h1 class="invoice-title">FAKTURA</h1>
                <h2 class="invoice-subtitle">DAŇOVÝ DOKLAD</h2>
                
                <div class="company-info">
                    <h5>{{ dodavatel.nazev_sro if dodavatel else 'Your energy, s.r.o.' }}</h5>
                    <p>{{ dodavatel.adresa_radek_1 if dodavatel else 'Italská 2584/69' }}</p>
                    <p>{{ dodavatel.adresa_radek_2 if dodavatel else '120 00 Praha 2 - Vinohrady' }}</p>
                    <p><strong>DIČ:</strong> {{ dodavatel.dic_sro if dodavatel else 'CZ24833851' }}</p>
                    <p><strong>IČO:</strong> {{ dodavatel.ico_sro if dodavatel else '24833851' }}</p>
                </div>
                
                <div class="company-info">
                    <p><strong>Banka:</strong> {{ dodavatel.banka if dodavatel else 'Bankovní účet Raiffeisenbank a.s. CZK' }}</p>
                    <p><strong>Č.úč.:</strong> {{ dodavatel.cislo_uctu if dodavatel else '5041011366/5500' }}</p>
                    <p><strong>IBAN:</strong> {{ dodavatel.iban if dodavatel else 'CZ1055000000005041011366' }}</p>
                    <p><strong>SWIFT/BIC:</strong> {{ dodavatel.swift if dodavatel else 'RZBCCZPP' }}</p>
                </div>
            </td>
            
            <td class="header-right">
                <div class="invoice-details">
                    <h4>Faktura č. {{ faktura.cislo_faktury if faktura else '' }}</h4>
                    <p><strong>Konst. symbol:</strong> {{ faktura.konstantni_symbol if faktura else '' }}</p>
                    <p><strong>VS:</strong> {{ faktura.variabilni_symbol if faktura else '' }}</p>
                </div>
                
                <div class="address-block">
                    <h6>Odběratel:</h6>
                    <p><strong>{{ odberatel.nazev_sro if odberatel else '' }}</strong></p>
                    <p>{{ odberatel.adresa_radek_1 if odberatel else '' }}</p>
                    <p>{{ odberatel.adresa_radek_2 if odberatel else '' }}</p>
                    <p><strong>IČO:</strong> {{ odberatel.ico_sro if odberatel else '' }}</p>
                    <p><strong>DIČ:</strong> {{ odberatel.dic_sro if odberatel else '' }}</p>
                </div>
                
                <div class="mt-3">
                    <p><strong>Středisko:</strong> {{ stredisko.stredisko }} {{ stredisko.nazev_strediska }}</p>
                    <p>{{ stredisko.stredisko_mail if stredisko.stredisko_mail else 'info@yourenergy.cz' }}</p>
                </div>
            </td>
        </tr>
    </table>

    <!-- DODACÍ A PLATEBNÍ PODMÍNKY -->
    <div class="no-break">
        <h5 class="section-title">Dodací a platební podmínky</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Datum splatnosti</th>
                    <th>Datum vystavení</th>
                    <th>Datum zdanit. plnění</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ faktura.datum_splatnosti.strftime('%d.%m.%Y') if faktura and faktura.datum_splatnosti else '' }}</td>
                    <td>{{ faktura.datum_vystaveni.strftime('%d.%m.%Y') if faktura and faktura.datum_vystaveni else '' }}</td>
                    <td>{{ faktura.datum_zdanitelneho_plneni.strftime('%d.%m.%Y') if faktura and faktura.datum_zdanitelneho_plneni else '' }}</td>
                </tr>
            </tbody>
        </table>
        
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Forma úhrady</th>
                    <th>Popis dodávky</th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ faktura.forma_uhrady if faktura else '' }}</td>
                    <td>{{ faktura.popis_dodavky if faktura else 'Vyúčtování ' + obdobi.rok|string + '%02d'|format(obdobi.mesic) }}</td>
                    <td></td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- REKAPITULACE -->
    <div class="no-break">
        <h5 class="section-title">Rekapitulace</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th><strong>Rekapitulace</strong></th>
                    <th>Základ daně</th>
                    <th>Sazba DPH</th>
                    <th>Částka DPH</th>
                    <th>Celkem vč. DPH</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Měsíční plat (za jistič)</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.platba_za_jistic) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.platba_za_jistic * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.platba_za_jistic * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Plat za elektřinu ve VT</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.distribuce_vt) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.distribuce_vt * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.distribuce_vt * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Plat za elektřinu ve NT</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.distribuce_nt) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.distribuce_nt * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.distribuce_nt * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Cena za systémové služby</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.systemove_sluzby) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.systemove_sluzby * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.systemove_sluzby * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Podpora elekt. z podporovaných zdrojů energie</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.poze_minimum) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.poze_minimum * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.poze_minimum * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Poplatek za nesíťovou infrastrukturu</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.nesitova_infrastruktura) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.nesitova_infrastruktura * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.nesitova_infrastruktura * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Stálý plat (dodavatel)</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.mesicni_plat) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.mesicni_plat * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.mesicni_plat * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Plat za silovou elektřinu v VT (dodavatel)</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.elektrinu_vt) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.elektrinu_vt * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.elektrinu_vt * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Plat za silovou elektřinu v NT (dodavatel)</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.elektrinu_nt) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.elektrinu_nt * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.elektrinu_nt * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Daň</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.dan_z_elektriny) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.dan_z_elektriny * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.dan_z_elektriny * (1 + sazba_dph)) }}</td>
                </tr>
                <tr>
                    <td>Dofakturace / Bonus</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.dofakturace_bonus) }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.dofakturace_bonus * sazba_dph) }}</td>
                    <td class="text-end">{{ "%.2f"|format(rekapitulace.dofakturace_bonus * (1 + sazba_dph)) }}</td>
                </tr>
                <tr class="final-total">
                    <td><strong>Celkem za doklad</strong></td>
                    <td class="text-end"><strong>{{ "%.2f"|format(zaklad_bez_dph) }}</strong></td>
                    <td class="text-end"></td>
                    <td class="text-end"><strong>{{ "%.2f"|format(castka_dph) }}</strong></td>
                    <td class="text-end"><strong>{{ "%.2f"|format(celkem_vc_dph) }}</strong></td>
                </tr>
                <tr>
                    <td>Zaplaceno zálohou</td>
                    <td class="text-end">{{ "%.2f"|format(-zaloha_hodnota) if zaloha else "0,00" }}</td>
                    <td class="text-end">{{ sazba_dph_procenta }}</td>
                    <td class="text-end">{{ "%.2f"|format(-zaloha_dph) if zaloha else "0,00" }}</td>
                    <td class="text-end">{{ "%.2f"|format(-zaloha_celkem_vc_dph) if zaloha else "0,00" }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- K PLATBĚ -->
    <div class="total-section">
        <h4 class="total-amount">K platbě celkem Kč {{ "%.2f"|format(k_platbe) }}</h4>
    </div>

    <!-- REKAPITULACE DPH -->
    <div class="no-break">
        <h5 class="section-title">Rekapitulace DPH</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Sazba DPH</th>
                    <th>Základ daně</th>
                    <th>DPH</th>
                    <th>Celkem</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Základní sazba 21 %</td>
                    <td class="text-end">{{ "%.2f"|format(k_platbe / (1 + sazba_dph)) }}</td>
                    <td class="text-end">{{ "%.2f"|format(k_platbe * sazba_dph / (1 + sazba_dph)) }}</td>
                    <td class="text-end">{{ "%.2f"|format(k_platbe) }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- FOOTER -->
    <div class="footer-section">
        <p>Rozpis jednotlivých položek faktury je uveden na následující straně.</p>
        <p><strong>FAKTURA:</strong> {{ faktura.cislo_faktury if faktura else '270325044' }}</p>
    </div>
</body>
</html>