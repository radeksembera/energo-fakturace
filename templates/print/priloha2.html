<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Příloha 2 - Rozpis položek za odběrná místa</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        
        .om-container {
            margin-bottom: 40px;
            page-break-inside: avoid;
        }
        
        .om-info {
            margin-bottom: 20px;
        }
        
        .om-info p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        h2 {
            font-size: 1.4em;
            margin-top: 2em;
            margin-bottom: 10px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        td, th {
            padding: 5px;
            vertical-align: top;
        }
        
        .right {
            text-align: right;
        }
        
        .bold {
            font-weight: bold;
        }
        
        .section-title {
            font-weight: bold;
            font-size: 1.1em;
            margin-top: 20px;
            margin-bottom: 5px;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.5em;
            text-align: right;
            margin-top: 10px;
        }
        
        .line {
            border-top: 1px solid #ccc;
            margin-top: 20px;
        }
        
        .page-break {
            page-break-after: always;
        }
        
        /* WeasyPrint optimalizace */
        @media print {
            body {
                margin: 20px;
            }
            
            .om-container {
                page-break-inside: avoid;
            }
            
            table {
                page-break-inside: avoid;
            }
        }

    </style>
</head>
<body>

    {% for data in vypocty_data %}
    <div class="om-container">
        
        <!-- Informace o odběrném místě -->
        <div class="om-info">
            <p><strong>Odběrné místo:</strong> {{ data.om.cislo_om }} {{ data.om.nazev_om }}<br>
            {{ stredisko.adresa if stredisko.adresa else 'Nádražní 762/32, Praha 5 - Smíchov, PSČ 150 00' }}<br>
            <strong>EAN:</strong> {{ data.om.ean_om if data.om.ean_om else '859182403280020114' }}</p>

            <p>
                <strong>Distribuční sazba:</strong> {{ data.om.distribucni_sazba_om }}<br>
                <strong>Kategorie hlavního jističe:</strong> {{ data.om.kategorie_jistice_om }}<br>
                <strong>Hodnota hlavního jističe [A]:</strong> {{ data.om.hodnota_jistice_om }}<br>
                <strong>Období fakturace:</strong> 
                {{ faktura.fakturace_od.strftime('%d.%m.%Y') if faktura and faktura.fakturace_od else '01.06.2025' }} - 
                {{ faktura.fakturace_do.strftime('%d.%m.%Y') if faktura and faktura.fakturace_do else '30.06.2025' }}
            </p>
        </div>

        <!-- Dodávka elektřiny -->
        <div class="section-title">Dodávka elektřiny</div>
        <table>
            <tr>
                <td>Stálý plat</td>
                <td class="right">1</td>
                <td class="right">1</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.mesicni_plat or 0) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.mesicni_plat or 0) }}</td>
            </tr>
            <tr>
                <td>Plat za silovou elektřinu v VT</td>
                <td class="right">{{ "%.4f"|format(data.spotreba_vt_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_elektriny_vt) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.platba_za_elektrinu_vt or 0) }}</td>
            </tr>
            <tr>
                <td>Plat za silovou elektřinu v NT</td>
                <td class="right">{{ "%.4f"|format(data.spotreba_nt_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_elektriny_nt) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.platba_za_elektrinu_nt or 0) }}</td>
            </tr>
        </table>

        <!-- Distribuční služby -->
        <div class="section-title">Distribuční služby</div>
        <table>
            <tr>
                <td>Měsíční plat</td>
                <td class="right">1</td>
                <td class="right">1</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.platba_za_jistic or 0) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.platba_za_jistic or 0) }}</td>
            </tr>
            <tr>
                <td>Plat za elektřinu ve VT</td>
                <td class="right">{{ "%.4f"|format(data.spotreba_vt_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_distribuce_vt) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.platba_za_distribuci_vt or 0) }}</td>
            </tr>
            <tr>
                <td>Plat za elektřinu ve NT</td>
                <td class="right">{{ "%.4f"|format(data.spotreba_nt_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_distribuce_nt) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.platba_za_distribuci_nt or 0) }}</td>
            </tr>
            <tr>
                <td>Cena za systémové služby</td>
                <td class="right">{{ "%.4f"|format(data.celkova_spotreba_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_systemove_sluzby) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.systemove_sluzby or 0) }}</td>
            </tr>
            <tr>
                <td>Podpora elekt. z podporovaných zdrojů energie</td>
                <td class="right">{{ "%.4f"|format(data.celkova_spotreba_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_poze) }}</td>
                <td class="right">{{ "%.2f"|format(data.poze_minimum or 0) }}</td>
            </tr>
            <tr>
                <td>Poplatek za nesíťovou infrastrukturu</td>
                <td class="right">1</td>
                <td class="right">1</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.nesitova_infrastruktura or 0) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.nesitova_infrastruktura or 0) }}</td>
            </tr>
        </table>

        <!-- Daň -->
        <div class="section-title">Daň</div>
        <table>
            <tr>
                <td>Daň</td>
                <td class="right">{{ "%.4f"|format(data.celkova_spotreba_mwh) }}</td>
                <td class="right">MWh</td>
                <td class="right">{{ "%.2f"|format(data.jednotkova_cena_dan) }}</td>
                <td class="right">{{ "%.2f"|format(data.vypocet.dan_z_elektriny or 0) }}</td>
            </tr>
        </table>

        <div class="line"></div>

        <div class="total">Celkem: {{ "%.2f"|format(data.celkem_om) }}</div>
    </div>
    {% endfor %}

</body>
</html>