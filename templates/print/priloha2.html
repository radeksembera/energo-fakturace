<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Příloha 2 - Rozpis položek za odběrná místa</title>
    <style>
        @page {
            margin: 15mm 10mm;
            @bottom-left {
                content: "FAKTURA: {{ faktura.cislo_faktury if faktura else '' }}";
                font-family: Arial, sans-serif;
                font-size: 9px;
            }
            @bottom-right {
                content: "strana " counter(page) "/" counter(pages);
                font-family: Arial, sans-serif;
                font-size: 9px;
            }
        }
        body {
            font-family: Arial, sans-serif;
            margin: 0;
        }
        
        .om-container {
            margin-bottom: 40px;
            page-break-inside: avoid;
        }

        /* ✅ PAGE BREAK - každé OM na nové stránce */
        .om-page-break {
            page-break-after: always;
        }
        
        .om-info {
            margin-bottom: 20px;
        }
        
        .om-info p {
            margin: 5px 0;
            line-height: 1.4;
        }
        
        h2 {
            font-size: 1.4em;
            margin-top: 2em;
            margin-bottom: 10px;
        }
        
        table.items-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        table.items-table th {
            padding: 3px 5px;
            text-align: left;
            font-weight: bold;
        }
        
        table.items-table th.right {
            text-align: right;
        }
        
        table.items-table td {
            padding: 2px 5px;
            vertical-align: top;
            line-height: 1.2;
        }
        
        .right {
            text-align: right;
        }
        
        .bold {
            font-weight: bold;
        }
        
        .category-row {
            font-weight: bold;
            background-color: #f5f5f5;
        }
        
        .category-row td {
            padding: 3px 5px !important;
        }
        
        .item-row td:first-child {
            padding-left: 20px;
        }
        
        .total {
            font-weight: bold;
            font-size: 1.5em;
            text-align: right;
            margin-top: 10px;
        }
        
        .line {
            border-top: 1px solid #ccc;
            margin-top: 20px;
        }
        
        .page-break {
            page-break-after: always;
        }
        
        /* WeasyPrint optimalizace */
        @media print {
            body {
                margin: 20px;
            }
            
            .om-container {
                page-break-inside: avoid;
            }
            
            table {
                page-break-inside: avoid;
            }
        }

    </style>
</head>
<body>

    {% for data in vypocty_data %}
    <div class="om-container {% if faktura and faktura.om_na_stranku %}om-page-break{% endif %}">
        
        <!-- Informace o odběrném místě -->
        <div class="om-info">
            <p><strong>Odběrné místo:</strong> {{ data.om.cislo_om }} {{ data.om.nazev_om }}<br>
            {{ stredisko.adresa if stredisko.adresa else '' }}<br>
            <strong>EAN:</strong> {{ data.om.ean_om if data.om.ean_om else '' }}</p>

            <p>
                <strong>Distribuční sazba:</strong> {{ data.om.distribucni_sazba_om }}<br>
                <strong>Kategorie hlavního jističe:</strong> {{ data.om.kategorie_jistice_om }}<br>
                <strong>Hodnota hlavního jističe [A]:</strong> {{ data.om.hodnota_jistice_om }}<br>
                <strong>Období fakturace:</strong> 
                {{ faktura.fakturace_od.strftime('%d.%m.%Y') if faktura and faktura.fakturace_od else '' }} -
                {{ faktura.fakturace_do.strftime('%d.%m.%Y') if faktura and faktura.fakturace_do else '' }}
            </p>
        </div>

        <!-- Kompaktní tabulka se všemi položkami -->
        <table class="items-table">
            <thead>
                <tr>
                    <th></th>
                    <th class="right">Množství</th>
                    <th class="right">MJ</th>
                    <th class="right">Jednotková cena</th>
                    <th class="right">Celková cena</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dodávka elektřiny -->
                {% set has_dodavka = (data.vypocet.mesicni_plat and data.vypocet.mesicni_plat != 0) or (data.vypocet.platba_za_elektrinu_vt and data.vypocet.platba_za_elektrinu_vt != 0) or (data.vypocet.platba_za_elektrinu_nt and data.vypocet.platba_za_elektrinu_nt != 0) %}
                {% if has_dodavka %}
                <tr class="category-row">
                    <td colspan="5"><strong>Dodávka elektřiny</strong></td>
                </tr>
                {% if data.vypocet.mesicni_plat and data.vypocet.mesicni_plat != 0 %}
                <tr class="item-row">
                    <td>Stálý plat</td>
                    <td class="right">{{ (data.vypocet.delka_obdobi_fakturace or 1)|czech_number(3) }}</td>
                    <td class="right">měs.</td>
                    <td class="right">{{ data.jednotkova_cena_mesicni_plat|number_format }}</td>
                    <td class="right">{{ (data.vypocet.mesicni_plat or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.platba_za_elektrinu_vt and data.vypocet.platba_za_elektrinu_vt != 0 %}
                <tr class="item-row">
                    <td>Plat za silovou elektřinu v VT</td>
                    <td class="right">{{ data.spotreba_vt_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_elektriny_vt|number_format }}</td>
                    <td class="right">{{ (data.vypocet.platba_za_elektrinu_vt or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.platba_za_elektrinu_nt and data.vypocet.platba_za_elektrinu_nt != 0 %}
                <tr class="item-row">
                    <td>Plat za silovou elektřinu v NT</td>
                    <td class="right">{{ data.spotreba_nt_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_elektriny_nt|number_format }}</td>
                    <td class="right">{{ (data.vypocet.platba_za_elektrinu_nt or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% endif %}
                
                <!-- Distribuční služby -->
                {% set has_distribuce = (data.vypocet.platba_za_jistic and data.vypocet.platba_za_jistic != 0) or (data.vypocet.platba_za_distribuci_vt and data.vypocet.platba_za_distribuci_vt != 0) or (data.vypocet.platba_za_distribuci_nt and data.vypocet.platba_za_distribuci_nt != 0) or (data.vypocet.systemove_sluzby and data.vypocet.systemove_sluzby != 0) or (data.poze_minimum and data.poze_minimum != 0) or (data.vypocet.nesitova_infrastruktura and data.vypocet.nesitova_infrastruktura != 0) %}
                {% if has_distribuce %}
                <tr class="category-row">
                    <td colspan="5"><strong>Distribuční služby</strong></td>
                </tr>
                {% if data.vypocet.platba_za_jistic and data.vypocet.platba_za_jistic != 0 %}
                <tr class="item-row">
                    <td>Měsíční plat</td>
                    <td class="right">{{ (data.vypocet.delka_obdobi_fakturace or 1)|czech_number(3) }}</td>
                    <td class="right">měs.</td>
                    <td class="right">{{ data.jednotkova_cena_jistic|number_format }}</td>
                    <td class="right">{{ (data.vypocet.platba_za_jistic or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.platba_za_distribuci_vt and data.vypocet.platba_za_distribuci_vt != 0 %}
                <tr class="item-row">
                    <td>Plat za elektřinu ve VT</td>
                    <td class="right">{{ data.spotreba_vt_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_distribuce_vt|number_format }}</td>
                    <td class="right">{{ (data.vypocet.platba_za_distribuci_vt or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.platba_za_distribuci_nt and data.vypocet.platba_za_distribuci_nt != 0 %}
                <tr class="item-row">
                    <td>Plat za elektřinu ve NT</td>
                    <td class="right">{{ data.spotreba_nt_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_distribuce_nt|number_format }}</td>
                    <td class="right">{{ (data.vypocet.platba_za_distribuci_nt or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.systemove_sluzby and data.vypocet.systemove_sluzby != 0 %}
                <tr class="item-row">
                    <td>Cena za systémové služby</td>
                    <td class="right">{{ data.celkova_spotreba_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_systemove_sluzby|number_format }}</td>
                    <td class="right">{{ (data.vypocet.systemove_sluzby or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.poze_minimum and data.poze_minimum != 0 %}
                <tr class="item-row">
                    <td>Podpora elekt. z podporovaných zdrojů energie</td>
                    {% if data.poze_je_jistic %}
                    <td class="right">{{ (data.vypocet.delka_obdobi_fakturace or 1)|czech_number(3) }}</td>
                    <td class="right">měs.</td>
                    <td class="right">{{ data.jednotkova_cena_poze_jistic|number_format }}</td>
                    {% else %}
                    <td class="right">{{ data.celkova_spotreba_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_poze|number_format }}</td>
                    {% endif %}
                    <td class="right">{{ (data.poze_minimum or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.nesitova_infrastruktura and data.vypocet.nesitova_infrastruktura != 0 %}
                <tr class="item-row">
                    <td>Poplatek za nesíťovou infrastrukturu</td>
                    <td class="right">{{ (data.vypocet.delka_obdobi_fakturace or 1)|czech_number(3) }}</td>
                    <td class="right">měs.</td>
                    <td class="right">{{ data.jednotkova_cena_nesitova_infra|number_format }}</td>
                    <td class="right">{{ (data.vypocet.nesitova_infrastruktura or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% endif %}
                
                <!-- Ostatní (Daň, Dofakturace, Slevový bonus) -->
                {% set has_ostatni = (data.vypocet.dan_z_elektriny and data.vypocet.dan_z_elektriny != 0) or (data.vypocet.dofakturace and data.vypocet.dofakturace != 0) or (data.vypocet.slevovy_bonus and data.vypocet.slevovy_bonus != 0) %}
                {% if has_ostatni %}
                <tr class="category-row">
                    <td colspan="5"><strong>Ostatní</strong></td>
                </tr>
                {% if data.vypocet.dan_z_elektriny and data.vypocet.dan_z_elektriny != 0 %}
                <tr class="item-row">
                    <td>Daň</td>
                    <td class="right">{{ data.celkova_spotreba_mwh|czech_number(4) }}</td>
                    <td class="right">MWh</td>
                    <td class="right">{{ data.jednotkova_cena_dan|number_format }}</td>
                    <td class="right">{{ (data.vypocet.dan_z_elektriny or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.dofakturace and data.vypocet.dofakturace != 0 %}
                <tr class="item-row">
                    <td>Dofakturace</td>
                    <td class="right">1</td>
                    <td class="right">měs.</td>
                    <td class="right">{{ (data.vypocet.dofakturace or 0)|number_format }}</td>
                    <td class="right">{{ (data.vypocet.dofakturace or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% if data.vypocet.slevovy_bonus and data.vypocet.slevovy_bonus != 0 %}
                <tr class="item-row">
                    <td>Slevový bonus</td>
                    <td class="right">1</td>
                    <td class="right">měs.</td>
                    <td class="right">-{{ (data.vypocet.slevovy_bonus or 0)|number_format }}</td>
                    <td class="right">-{{ (data.vypocet.slevovy_bonus or 0)|number_format }}</td>
                </tr>
                {% endif %}
                {% endif %}
            </tbody>
        </table>

        <div class="line"></div>

        <div class="total">Celkem bez DPH: {{ data.celkem_om|number_format }} Kč</div>
    </div>
    {% endfor %}

    <!-- Další důležité informace -->
    <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #ccc; page-break-before: always;">
        <h1 style="font-size: 1.3em; margin: 0 0 0.8rem 0; font-weight: bold;">Další důležité informace</h1>

        <section style="margin-bottom: 1rem;">
            <h2 style="font-size: 1em; margin: 0.8rem 0 0.4rem 0; font-weight: bold;">Podíl jednotlivých zdrojů nebo původů energie na celkové směsi paliv dodavatele v roce 2024</h2>
            <table style="border-collapse: collapse; width: 100%; margin: 0.3rem 0;">
                <thead>
                    <tr>
                        <th style="padding: 3px 5px; text-align: left; font-weight: bold;">Původ elektřiny</th>
                        <th style="padding: 3px 5px; text-align: left; font-weight: bold; width: 100px;">% podíl</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td style="padding: 2px 5px; line-height: 1.2;">Uhelné elektrárny (uhlí)</td><td style="padding: 2px 5px; line-height: 1.2;">44,69</td></tr>
                    <tr><td style="padding: 2px 5px; line-height: 1.2;">Jaderné elektrárny (jádro)</td><td style="padding: 2px 5px; line-height: 1.2;">42,82</td></tr>
                    <tr><td style="padding: 2px 5px; line-height: 1.2;">Podíl elektřiny vyrobené ze zemního plynu</td><td style="padding: 2px 5px; line-height: 1.2;">5,79</td></tr>
                    <tr><td style="padding: 2px 5px; line-height: 1.2;">Obnovitelné zdroje energie (OZE)</td><td style="padding: 2px 5px; line-height: 1.2;">6,4</td></tr>
                    <tr><td style="padding: 2px 5px; line-height: 1.2;">Druhotné zdroje</td><td style="padding: 2px 5px; line-height: 1.2;">0,16</td></tr>
                    <tr><td style="padding: 2px 5px; line-height: 1.2;">Ostatní zdroje</td><td style="padding: 2px 5px; line-height: 1.2;">0,14</td></tr>
                    <tr><td style="padding: 2px 5px; line-height: 1.2; font-weight: bold;">celkem</td><td style="padding: 2px 5px; line-height: 1.2; font-weight: bold;">100</td></tr>
                </tbody>
            </table>
        </section>

        <section style="margin-bottom: 1rem;">
            <h2 style="font-size: 1em; margin: 0.8rem 0 0.4rem 0; font-weight: bold;">Informace o dopadech výroby elektřiny na životní prostředí</h2>
            <p style="margin: 0.3rem 0; text-align: justify;">Informace o dopadech výroby elektřiny na životní prostředí jsou dostupné na internetových stránkách Ministerstva životního prostředí <a href="https://www.mzp.cz" style="color: #0b57d0; text-decoration: none;" target="_blank" rel="noopener">www.mzp.cz</a>.</p>
        </section>

        <section style="margin-bottom: 1rem;">
            <h2 style="font-size: 1em; margin: 0.8rem 0 0.4rem 0; font-weight: bold;">Reklamace, řešení sporů</h2>
            <p style="margin: 0.3rem 0; text-align: justify;">Zákazník může k vyúčtování dodávek elektřiny a souvisejících služeb uplatnit reklamaci na adrese <a href="mailto:mikes@yourenergy.cz" style="color: #0b57d0; text-decoration: none;">mikes@yourenergy.cz</a> nebo na adrese Your energy, s.r.o. Italská 2584/69 120 00 Praha 2 IČ: 24833851, ve lhůtě 30 dnů ode dne doručení. V případě vzniku sporu mezi zákazníkem a dodavatelem může zákazník podat návrh na rozhodnutí tohoto sporu podle § 17 odst. 7 energetického zákona, přitom musí postupovat podle správního řádu.</p>
        </section>

        <section style="margin-bottom: 1rem;">
            <h2 style="font-size: 1em; margin: 0.8rem 0 0.4rem 0; font-weight: bold;">Změna dodavatele</h2>
            <p style="margin: 0.3rem 0; text-align: justify;">Zákazníci a spotřebitelé mají právo zvolit si a bezplatně změnit svého dodavatele. Každý zákazník se podpisem smlouvy zavázal dodržet její podmínky. Pokud je smlouva uzavřena na dobu určitou, je zákazník povinen tento závazek dodržet. Při ukončení smluvního vztahu je tedy nutné postupovat dle smlouvy, dodatku a všeobecných obchodních podmínek, které jsou nedílnou součástí každé smlouvy. Před změnou dodavatele je vhodné si zjistit, zda je změna dodavatele výhodná, a to nejen srovnáním ceny, ale i Obchodních podmínek dodavatele. Pro nezávislé porovnání cenových nabídek dodavatelů můžete využít například kalkulačku Energetického regulačního úřadu, kterou naleznete na adrese <a href="https://www.eru.cz" style="color: #0b57d0; text-decoration: none;" target="_blank" rel="noopener">www.eru.cz</a>.</p>
        </section>

        <section style="margin-bottom: 1rem;">
            <h2 style="font-size: 1em; margin: 0.8rem 0 0.4rem 0; font-weight: bold;">Důležité kontaktní údaje</h2>
            <h3 style="font-size: 1em; margin: 0.5rem 0 0.3rem 0; font-weight: bold;">Energetický regulační úřad</h3>
            <address style="font-style: normal; margin: 0.3rem 0;">
                adresa sídla: Masarykovo náměstí 5, 586 01 Jihlava<br>
                telefonní číslo: 564 578 666 – ústředna<br>
                adresa webových stránek: <a href="https://www.eru.cz" style="color: #0b57d0; text-decoration: none;" target="_blank" rel="noopener">www.eru.cz</a><br>
                adresa elektronické podatelny: <a href="mailto:podatelna@eru.cz" style="color: #0b57d0; text-decoration: none;">podatelna@eru.cz</a>
            </address>
        </section>
    </div>

</body>
</html>