<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Faktura {{ faktura.cislo_faktury if faktura else '' }}</title>
    <style>
        @page { 
            margin: 1cm;
            size: A4;
        }
        
        * {
            box-sizing: border-box;
        }
        
        body { 
            font-family: "DejaVu Sans", Arial, sans-serif;
            font-size: 10px; 
            line-height: 1.2;
            margin: 0;
            padding: 0;
            color: #333;
        }
        
        /* Layout pomocí tabulek místo Bootstrap gridu */
        .header-table {
            width: 100%;
            margin-bottom: 15px;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .header-table td {
            vertical-align: top;
            padding: 5px;
        }
        
        .header-left {
            width: 50%;
        }
        
        .header-right {
            width: 50%;
            text-align: right;
        }
        
        .invoice-title {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            text-transform: uppercase;
            margin: 0 0 3px 0;
        }
        
        .invoice-subtitle {
            font-size: 12px;
            color: #6c757d;
            margin: 0 0 10px 0;
        }
        
        .company-info {
            margin-bottom: 8px;
        }
        
        .company-info h5 {
            font-size: 12px;
            margin: 0 0 3px 0;
            font-weight: bold;
        }
        
        .company-info p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        .invoice-details {
            background-color: #f8f9fa;
            padding: 8px;
            border-radius: 3px;
            border-left: 3px solid #007bff;
            margin-bottom: 8px;
        }
        
        .invoice-details h4 {
            margin: 0 0 5px 0;
            font-size: 14px;
        }
        
        .invoice-details p {
            margin: 2px 0;
        }
        
        .address-block {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 3px;
            padding: 8px;
            margin-top: 8px;
        }
        
        .address-block h6 {
            color: #007bff;
            margin: 0 0 5px 0;
            font-size: 11px;
            font-weight: bold;
        }
        
        .address-block p {
            margin: 1px 0;
            font-size: 10px;
        }
        
        /* Tabulky */
        .section-title {
            color: #007bff;
            font-size: 12px;
            font-weight: bold;
            margin: 15px 0 5px 0;
        }
        
        .custom-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 10px;
            font-size: 9px;
        }
        
        .custom-table th {
            background-color: #f5f5f5;
            color: #333;
            font-weight: bold;
            padding: 4px 3px;
            border: none;
            text-align: center;
        }
        
        .custom-table th:first-child {
            text-align: left;
        }
        
        .custom-table td {
            padding: 3px;
            border: none;
            vertical-align: top;
            text-align: center;
        }
        
        .custom-table td:first-child {
            text-align: left;
        }
        
        .custom-table .text-end {
            text-align: right;
        }
        
        .custom-table .text-center {
            text-align: center;
        }
        
        /* Celkové částky */
        .final-total {
            background-color: #f5f5f5 !important;
            font-weight: bold !important;
        }
        
        .final-total td {
            background-color: #f5f5f5 !important;
            border: none !important;
            padding-top: 5px !important;
            padding-bottom: 5px !important;
        }
        
        .total-section {
            text-align: right;
            margin: 10px 0;
        }
        
        .total-amount {
            color: #333;
            font-size: 14px;
            font-weight: bold;
            padding: 8px 0;
            margin: 0;
        }
        
        /* Footer */
        .footer-section {
            margin-top: 15px;
            text-align: center;
            color: #6c757d;
            font-size: 9px;
        }
        
        .footer-section p {
            margin: 3px 0;
        }
        
        /* Utility classes */
        .mb-0 { margin-bottom: 0; }
        .mb-1 { margin-bottom: 2px; }
        .mb-2 { margin-bottom: 4px; }
        .mb-3 { margin-bottom: 6px; }
        .mt-3 { margin-top: 6px; }
        .mt-4 { margin-top: 8px; }
        .mt-5 { margin-top: 12px; }
        
        strong { font-weight: bold; }
        
        /* Page break control */
        .no-break {
            page-break-inside: avoid;
        }
        
        /* Format čísel s mezerami jako oddělovači tisíců */
        .number-format {
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- HLAVIČKA -->
    <table class="header-table">
        <tr>
            <td class="header-left">
                <h1 class="invoice-title">FAKTURA</h1>
                <h2 class="invoice-subtitle">DAŇOVÝ DOKLAD</h2>
                
                <div class="company-info">
                    <h5>{{ dodavatel.nazev_sro if dodavatel else '' }}</h5>
                    <p>{{ dodavatel.adresa_radek_1 if dodavatel else '' }}</p>
                    <p>{{ dodavatel.adresa_radek_2 if dodavatel else '' }}</p>
                    <p><strong>DIČ:</strong> {{ dodavatel.dic_sro if dodavatel else '' }}</p>
                    <p><strong>IČO:</strong> {{ dodavatel.ico_sro if dodavatel else '' }}</p>
                </div>

                <div class="company-info">
                    <p><strong>Banka:</strong> {{ dodavatel.banka if dodavatel else '' }}</p>
                    <p><strong>Č.úč.:</strong> {{ dodavatel.cislo_uctu if dodavatel else '' }}</p>
                    <p><strong>IBAN:</strong> {{ dodavatel.iban if dodavatel else '' }}</p>
                    <p><strong>SWIFT/BIC:</strong> {{ dodavatel.swift if dodavatel else '' }}</p>
                </div>
            </td>
            
            <td class="header-right">
                <div class="invoice-details">
                    <h4>Faktura č. {{ faktura.cislo_faktury if faktura else '' }}</h4>
                    <p><strong>Variabilní symbol:</strong> {{ faktura.variabilni_symbol if faktura else '' }}</p>
                </div>
                
                <div class="address-block">
                    <h6>Odběratel:</h6>
                    <p><strong>{{ odberatel.nazev_sro if odberatel else '' }}</strong></p>
                    <p>{{ odberatel.adresa_radek_1 if odberatel else '' }}</p>
                    <p>{{ odberatel.adresa_radek_2 if odberatel else '' }}</p>
                    <p><strong>IČO:</strong> {{ odberatel.ico_sro if odberatel else '' }}</p>
                    <p><strong>DIČ:</strong> {{ odberatel.dic_sro if odberatel else '' }}</p>
                </div>
                
                <div class="mt-3">
                    <p><strong>Středisko:</strong> {{ stredisko.stredisko }} {{ stredisko.nazev_strediska }}</p>
                    <p>{{ stredisko.stredisko_mail if stredisko.stredisko_mail else '' }}</p>
                </div>
            </td>
        </tr>
    </table>

    <!-- DODACÍ A PLATEBNÍ PODMÍNKY -->
    <div class="no-break">
        <h5 class="section-title">Dodací a platební podmínky</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Datum splatnosti</th>
                    <th>Datum vystavení</th>
                    <th>Datum zdanit. plnění</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ faktura.datum_splatnosti.strftime('%d.%m.%Y') if faktura and faktura.datum_splatnosti else '' }}</td>
                    <td>{{ faktura.datum_vystaveni.strftime('%d.%m.%Y') if faktura and faktura.datum_vystaveni else '' }}</td>
                    <td>{{ faktura.datum_zdanitelneho_plneni.strftime('%d.%m.%Y') if faktura and faktura.datum_zdanitelneho_plneni else '' }}</td>
                </tr>
            </tbody>
        </table>
        
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Forma úhrady</th>
                    <th>Popis dodávky</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>{{ faktura.forma_uhrady if faktura else '' }}</td>
                    <td>{{ faktura.popis_dodavky if faktura else '' }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- REKAPITULACE -->
    <div class="no-break">
        <h5 class="section-title">Rekapitulace</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th><strong>Rekapitulace</strong></th>
                    <th>Základ daně</th>
                    <th>Sazba DPH</th>
                    <th>Částka DPH</th>
                    <th>Celkem vč. DPH</th>
                </tr>
            </thead>
            <tbody>
                {% if rekapitulace.platba_za_jistic != 0 %}
                <tr>
                    <td>Měsíční plat (za jistič)</td>
                    <td class="text-end number-format">{{ (rekapitulace.platba_za_jistic)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.platba_za_jistic * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.platba_za_jistic * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.distribuce_vt != 0 %}
                <tr>
                    <td>Plat za elektřinu ve VT</td>
                    <td class="text-end number-format">{{ (rekapitulace.distribuce_vt)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.distribuce_vt * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.distribuce_vt * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.distribuce_nt != 0 %}
                <tr>
                    <td>Plat za elektřinu ve NT</td>
                    <td class="text-end number-format">{{ (rekapitulace.distribuce_nt)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.distribuce_nt * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.distribuce_nt * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.systemove_sluzby != 0 %}
                <tr>
                    <td>Cena za systémové služby</td>
                    <td class="text-end number-format">{{ (rekapitulace.systemove_sluzby)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.systemove_sluzby * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.systemove_sluzby * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.poze_minimum != 0 %}
                <tr>
                    <td>Podpora elekt. z podporovaných zdrojů energie</td>
                    <td class="text-end number-format">{{ (rekapitulace.poze_minimum)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.poze_minimum * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.poze_minimum * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.nesitova_infrastruktura != 0 %}
                <tr>
                    <td>Poplatek za nesíťovou infrastrukturu</td>
                    <td class="text-end number-format">{{ (rekapitulace.nesitova_infrastruktura)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.nesitova_infrastruktura * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.nesitova_infrastruktura * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.mesicni_plat != 0 %}
                <tr>
                    <td>Stálý plat (dodavatel)</td>
                    <td class="text-end number-format">{{ (rekapitulace.mesicni_plat)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.mesicni_plat * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.mesicni_plat * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.elektrinu_vt != 0 %}
                <tr>
                    <td>Plat za silovou elektřinu v VT (dodavatel)</td>
                    <td class="text-end number-format">{{ (rekapitulace.elektrinu_vt)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.elektrinu_vt * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.elektrinu_vt * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.elektrinu_nt != 0 %}
                <tr>
                    <td>Plat za silovou elektřinu v NT (dodavatel)</td>
                    <td class="text-end number-format">{{ (rekapitulace.elektrinu_nt)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.elektrinu_nt * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.elektrinu_nt * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.dan_z_elektriny != 0 %}
                <tr>
                    <td>Daň</td>
                    <td class="text-end number-format">{{ (rekapitulace.dan_z_elektriny)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.dan_z_elektriny * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.dan_z_elektriny * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                {% if rekapitulace.dofakturace_bonus != 0 %}
                <tr>
                    <td>Dofakturace / Bonus</td>
                    <td class="text-end number-format">{{ (rekapitulace.dofakturace_bonus)|number_format }}</td>
                    <td class="text-end">{{ (sazba_dph * 100)|round|int }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.dofakturace_bonus * sazba_dph)|number_format }}</td>
                    <td class="text-end number-format">{{ (rekapitulace.dofakturace_bonus * (1 + sazba_dph))|number_format }}</td>
                </tr>
                {% endif %}
                <tr class="final-total">
                    <td><strong>Celkem za doklad</strong></td>
                    <td class="text-end number-format"><strong>{{ (zaklad_bez_dph)|number_format }}</strong></td>
                    <td class="text-end"></td>
                    <td class="text-end number-format"><strong>{{ (castka_dph)|number_format }}</strong></td>
                    <td class="text-end number-format"><strong>{{ (celkem_vc_dph)|number_format }}</strong></td>
                </tr>
                <tr>
                    <td>Zaplaceno zálohou</td>
                    <td class="text-end number-format">{{ (-zaloha_hodnota).replace(',', ' ') if zaloha else "0,00" }}</td>
                    <td class="text-end">{{ sazba_dph_procenta }}</td>
                    <td class="text-end number-format">{{ (-zaloha_dph).replace(',', ' ') if zaloha else "0,00" }}</td>
                    <td class="text-end number-format">{{ (-zaloha_celkem_vc_dph).replace(',', ' ') if zaloha else "0,00" }}</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- K PLATBĚ -->
    <div class="total-section">
        <h4 class="total-amount">K platbě celkem {{ (k_platbe)|number_format }} Kč</h4>
    </div>

    <!-- REKAPITULACE DPH -->
    <div class="no-break">
        <h5 class="section-title">Rekapitulace DPH</h5>
        <table class="custom-table">
            <thead>
                <tr>
                    <th>Sazba DPH</th>
                    <th>Základ daně</th>
                    <th>DPH</th>
                    <th>Celkem</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Základní sazba 21 %</td>
                    <td class="text-end number-format">{{ (k_platbe / (1 + sazba_dph))|number_format }}</td>
                    <td class="text-end number-format">{{ (k_platbe * sazba_dph / (1 + sazba_dph))|number_format }}</td>
                    <td class="text-end number-format">{{ (k_platbe)|number_format }}</td>
                </tr>
            </tbody>
        </table>
    </div>

</body>
</html>