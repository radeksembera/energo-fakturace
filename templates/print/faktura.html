<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>Faktura {{ faktura.cislo_faktury if faktura else 'XXXX' }}</title>
    <style>
        @page { margin: 2cm; }
        body { font-family: Arial, sans-serif; font-size: 11px; line-height: 1.2; margin: 0; }
        .header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .company-info { width: 48%; }
        .invoice-info { width: 48%; }
        .title { font-size: 16px; font-weight: bold; margin-bottom: 15px; }
        .company-details { margin: 10px 0; }
        .customer-box { border: 2px solid #000; padding: 10px; margin: 10px 0; }
        .conditions-table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        .conditions-table th, .conditions-table td { 
            border: 1px solid #000; padding: 6px; text-align: left; font-size: 10px; 
        }
        .rekapitulace { width: 100%; border-collapse: collapse; margin: 20px 0; }
        .rekapitulace th, .rekapitulace td { 
            border: 1px solid #000; padding: 5px; text-align: left; font-size: 10px; 
        }
        .rekapitulace th { background-color: #f0f0f0; font-weight: bold; }
        .amount { text-align: right; }
        .total-row { font-weight: bold; background-color: #f5f5f5; }
        .final-amount { text-align: center; font-size: 14px; font-weight: bold; 
                       margin: 20px 0; padding: 10px; border: 2px solid #000; }
        .dph-table { width: 50%; margin: 20px 0; border-collapse: collapse; }
        .dph-table th, .dph-table td { border: 1px solid #000; padding: 5px; font-size: 10px; }
        .footer { margin-top: 30px; font-size: 9px; color: #666; }
        .right-align { text-align: right; }
    </style>
</head>
<body>
    <!-- HLAVIČKA -->
    <div class="header">
        <div class="company-info">
            <div class="title">FAKTURA - DAŇOVÝ DOKLAD</div>
            <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">
                {{ dodavatel.nazev_sro if dodavatel else 'Your energy, s.r.o.' }}
            </div>
            <div>{{ dodavatel.adresa_radek_1 if dodavatel else 'Italská 2584/69' }}</div>
            <div>{{ dodavatel.adresa_radek_2 if dodavatel else '120 00 Praha 2 - Vinohrady' }}</div>
            <div><strong>DIČ</strong> {{ dodavatel.dic_sro if dodavatel else 'CZ24833851' }}</div>
            <div><strong>IČO</strong> {{ dodavatel.ico_sro if dodavatel else '24833851' }}</div>
            
            <div class="company-details">
                <div><strong>Banka:</strong> {{ dodavatel.banka if dodavatel else 'Bankovní účet Raiffeisenbank a.s. CZK' }}</div>
                <div><strong>Č.úč.</strong> {{ dodavatel.cislo_uctu if dodavatel else '5041011366/5500' }}</div>
                <div><strong>IBAN</strong> {{ dodavatel.iban if dodavatel else 'CZ1055000000005041011366' }}</div>
                <div><strong>SWIFT/BIC</strong> {{ dodavatel.swift if dodavatel else 'RZBCCZPP' }}</div>
            </div>
        </div>
        
        <div class="invoice-info right-align">
            <div style="font-size: 14px; font-weight: bold; margin-bottom: 10px;">
                Číslo {{ faktura.cislo_faktury if faktura else '' }}
            </div>
            <div style="margin-bottom: 15px;">
                <div><strong>konst. symbol</strong> {{ faktura.konstantni_symbol if faktura else '' }}</div>
                <div><strong>VS</strong> {{ faktura.variabilni_symbol if faktura else '' }}</div>
            </div>
            <div>Objednávka:</div>
            
            <div class="customer-box">
                <div><strong>Odběratel:</strong></div>
                <div><strong>{{ odberatel.nazev_sro if odberatel else '' }}</strong></div>
                <div>{{ odberatel.adresa_radek_1 if odberatel else '' }}</div>
                <div>{{ odberatel.adresa_radek_2 if odberatel else '' }}</div>
                <div><strong>IČO:</strong> {{ odberatel.ico_sro if odberatel else '' }}</div>
                <div><strong>DIČ:</strong> {{ odberatel.dic_sro if odberatel else '' }}</div>
            </div>
            
            <div><strong>Středisko:</strong> {{ stredisko.stredisko }} {{ stredisko.nazev_strediska }}</div>
            <div style="margin-top: 10px;">{{ stredisko.stredisko_mail if stredisko.stredisko_mail else 'info@yourenergy.cz' }}</div>
        </div>
    </div>

    <!-- DODACÍ A PLATEBNÍ PODMÍNKY -->
    <table class="conditions-table">
        <tr>
            <th colspan="3"><strong>Dodací a platební podmínky</strong></th>
        </tr>
        <tr>
            <th>Datum splatnosti</th>
            <th>Datum vystavení</th>
            <th>Datum zdanit. plnění</th>
        </tr>
        <tr>
            <td>{{ faktura.datum_splatnosti.strftime('%d.%m.%Y') if faktura and faktura.datum_splatnosti else '' }}</td>
            <td>{{ faktura.datum_vystaveni.strftime('%d.%m.%Y') if faktura and faktura.datum_vystaveni else '' }}</td>
            <td>{{ faktura.datum_zdanitelneho_plneni.strftime('%d.%m.%Y') if faktura and faktura.datum_zdanitelneho_plneni else '' }}</td>
        </tr>
        <tr>
            <th>Forma úhrady</th>
            <th>Popis dodávky</th>
            <th></th>
        </tr>
        <tr>
            <td>{{ faktura.forma_uhrady if faktura else '' }}</td>
            <td>{{ faktura.popis_dodavky if faktura else 'Vyúčtování ' + obdobi.rok|string + '%02d'|format(obdobi.mesic) }}</td>
            <td></td>
        </tr>
    </table>

    <!-- REKAPITULACE -->
<!-- REKAPITULACE -->
<table class="rekapitulace">
    <tr>
        <th><strong>Rekapitulace</strong></th>
        <th>Základ daně</th>
        <th>Sazba DPH</th>
        <th>Částka DPH</th>
        <th>Celkem vč. DPH</th>
    </tr>
<tr>
    <td>Měsíční plat (za jistič)</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.platba_za_jistic) }}</td>
    <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.platba_za_jistic * sazba_dph) }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.platba_za_jistic * (1 + sazba_dph)) }}</td>
</tr>
<tr>
    <td>Plat za elektřinu ve VT</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.distribuce_vt) }}</td>
    <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.distribuce_vt * sazba_dph) }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.distribuce_vt * (1 + sazba_dph)) }}</td>
</tr>
<tr>
    <td>Plat za elektřinu ve NT</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.distribuce_nt) }}</td>
    <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.distribuce_nt * sazba_dph) }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.distribuce_nt * (1 + sazba_dph)) }}</td>
</tr>
    <tr>
        <td>Cena za systémové služby</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.systemove_sluzby) }}</td>
        <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.systemove_sluzby * sazba_dph) }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.systemove_sluzby * (1 + sazba_dph)) }}</td>
    </tr>
    <tr>
        <td>Podpora elekt. z podporovaných zdrojů energie</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.poze_minimum) }}</td>
        <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.poze_minimum * sazba_dph) }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.poze_minimum * (1 + sazba_dph)) }}</td>
    </tr>
    <tr>
        <td>Poplatek za nesíťovou infrastrukturu</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.nesitova_infrastruktura) }}</td>
        <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.nesitova_infrastruktura * sazba_dph) }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.nesitova_infrastruktura * (1 + sazba_dph)) }}</td>
    </tr>
<tr>
    <td>Stálý plat (dodavatel)</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.mesicni_plat) }}</td>
    <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.mesicni_plat * sazba_dph) }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.mesicni_plat * (1 + sazba_dph)) }}</td>
</tr>
<tr>
    <td>Plat za silovou elektřinu v VT (dodavatel)</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.elektrinu_vt) }}</td>
    <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.elektrinu_vt * sazba_dph) }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.elektrinu_vt * (1 + sazba_dph)) }}</td>
</tr>
<tr>
    <td>Plat za silovou elektřinu v NT (dodavatel)</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.elektrinu_nt) }}</td>
    <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.elektrinu_nt * sazba_dph) }}</td>
    <td class="amount">{{ "%.2f"|format(rekapitulace.elektrinu_nt * (1 + sazba_dph)) }}</td>
</tr>
    <tr>
        <td>Daň</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.dan_z_elektriny) }}</td>
        <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.dan_z_elektriny * sazba_dph) }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.dan_z_elektriny * (1 + sazba_dph)) }}</td>
    </tr>
    <tr>
        <td>Dofakturace / Bonus</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.dofakturace_bonus) }}</td>
        <td class="amount">{{ (sazba_dph * 100)|round|int }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.dofakturace_bonus * sazba_dph) }}</td>
        <td class="amount">{{ "%.2f"|format(rekapitulace.dofakturace_bonus * (1 + sazba_dph)) }}</td>
    </tr>
    <tr class="total-row">
        <td><strong>Celkem za doklad</strong></td>
        <td class="amount"><strong>{{ "%.2f"|format(zaklad_bez_dph) }}</strong></td>
        <td class="amount"></td>
        <td class="amount"><strong>{{ "%.2f"|format(castka_dph) }}</strong></td>
        <td class="amount"><strong>{{ "%.2f"|format(celkem_vc_dph) }}</strong></td>
    </tr>
    <tr>
    <td>Zaplaceno zálohou</td>
        <td class="amount">{{ "%.2f"|format(-zaloha_hodnota) if zaloha else "0,00" }}</td>
        <td class="amount">{{ sazba_dph_procenta }}</td>
        <td class="amount">{{ "%.2f"|format(-zaloha_dph) if zaloha else "0,00" }}</td>
        <td class="amount">{{ "%.2f"|format(-zaloha_celkem_vc_dph) if zaloha else "0,00" }}</td>
    </tr>
</table>

    <!-- K PLATBĚ -->
    <div class="final-amount">
        <strong>K platbě celkem Kč {{ "%.2f"|format(k_platbe) }}</strong>
    </div>

    <!-- REKAPITULACE DPH -->
    <table class="dph-table">
        <tr>
            <th colspan="4"><strong>Rekapitulace DPH</strong></th>
        </tr>
        <tr>
            <th>Sazba DPH</th>
            <th>Základ daně</th>
            <th>DPH</th>
            <th>Celkem</th>
        </tr>
        <tr>
            <td>Základní sazba 21 %</td>
            <td class="amount">{{ "%.2f"|format(k_platbe / (1 + sazba_dph)) }}</td>
            <td class="amount">{{ "%.2f"|format(k_platbe * sazba_dph / (1 + sazba_dph)) }}</td>
            <td class="amount">{{ "%.2f"|format(k_platbe) }}</td>
        </tr>
    </table>

    <!-- FOOTER -->
    <div class="footer">
        <p>Rozpis jednotlivých položek faktury je uveden na následující straně.</p>
        <p><strong>FAKTURA:</strong> {{ faktura.cislo_faktury if faktura else '270325044' }} &nbsp;&nbsp;&nbsp;&nbsp; Strana: 1 / 22</p>
            <div style="margin-top: 20px; text-align: center;">
    <a href="{{ url_for('fakturace.fakturace', stredisko_id=stredisko.id, obdobi_id=obdobi.id) }}" 
       style="padding: 8px 15px; background-color: #6c757d; color: white; text-decoration: none; border-radius: 3px;">
       ← Zpět na fakturaci (zachová období {{ obdobi.rok }}/{{ '%02d'|format(obdobi.mesic) }})
    </a>
</div>
    </div>
</body>
</html>